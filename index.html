<!DOCTYPE html>
<html>
  <head>
    <title>Severus Prototype</title> 
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="viewport" content= "width=device-width, user-scalable=no">

    <link rel="stylesheet" href="css/master.css">
    <link rel="manifest" href="json/manifest.json">
  </head>
  <body>
    <div id='Wrapper' class='wrapper'>
      <header>
        <h1 id="HeaderText">
          <!-- //////////////////////////////////// -->
          <!-- //////// headline goes here //////// -->
          <!-- //////////////////////////////////// -->
        </h1>
        <div class='progressBar-wrapper'>
          <div class='progressBar-bg'>
            <div class='progressBar-bar'></div>
          </div>
        </div> <!--  / .progressBar_wrapper -->
      </header>

      <div id="Card-Wrapper" class='card-wrapper'>
      <!-- //////////////////////////////////// -->
      <!-- //////// content goes here ///////// -->
      <!-- //////////////////////////////////// -->
      </div> <!--  / .content_wrapper -->

      <div class='btn-wrapper'>
        <button id="Btn_Next" class='btn btn-primary'>Next</button>
        <button id="Btn_Previous" class='btn btn-secondary'>Previous</button>
      </div>

    </div> <!--  / #Wrapper -->





    <div class="overlayPanel wrapper"></div> <!--  / .overlayPanel -->
    <div class="finishedOverlay wrapper">

      <h1>Complete!</h1>
      <div class='btn-wrapper'>
        <button id="Btn_Continue" class='btn btn-primary'>Continue</button>
      </div>
    </div> <!--  / .overlayPanel -->




  </body>

</html>


  <script src="js/scripts.js"></script>
  <script src="js/jquery-3.2.1.min.js"></script>
  <script src="js/handlebars-v4.2.0.js"></script>


  <!-- //////////////////////////////// -->
  <!-- //////// templates ///////////// -->
  <!-- //////////////////////////////// -->

  <script id="Card-Template" type="text/x-handlebars-template">
    <div class='content-card'>


      <h2>{{question}}</h2>

      <ul class="question-list">
        {{#each answers}}
          <li>
            <input type="radio" id="radio_{{answer}}" name="radio" />
            <label for="radio_{{answer}}"><span class="wrap"><span class="bullet"></span></span>{{answer}}</label>
          </li>
        {{/each}}
      </ul>
      <p>{{headline}}</p>
      <div class="slideWrapper">
        <div class="rangeOutput" id="rangeOutput">5</div>
        <div class="slidecontainer">
          <input type="range" min="0" max="10" value="5" class="slider" id="myRange">
        </div>
        <div>Strongly disagree = 0</div>
        <div>Strongly agree = 10</div>
      </div>

    </div>

  </script>

  <script id="Panel-Template" type="text/x-handlebars-template">
    <div class="panelContent">

      <h2>{{panelHeading}}</h2>
      <p>{{panelBody}}</p>

      <div class='btn-wrapper'>

        <button id="Btn_Start" class='btn btn-primary'>{{btnLabel}}</button>
        <!-- <button id="Btn_Close" class='btn btn-primary'>Close</button> -->
      </div>

    </div>
  </script>


  <script type="text/javascript">

    var numCurrentQ;
    var numTotalQ;

    var currentQuestionNum;
    var currentSection;

    var depressionQuestions;
    var insomniaQuestions;
    var anxietyQuestions;
    var beliefQuestions;

    var questionSet;
    var questionText;
    var answers;

    var cardTemplateSource;
    var cardTemplateClean;

    var panelTemplateSource;
    var panelTemplateClean;




    $(function(){


      ////////////////////////////////
      ////// page load  //////////////
      ////////////////////////////////

      // get the handlebars tempalate structure
      cardTemplateSource = document.getElementById("Card-Template").innerHTML;
      panelTemplateSource = document.getElementById("Panel-Template").innerHTML;

      // sprinkle some magic dust
      cardTemplateClean = Handlebars.compile(cardTemplateSource);
      panelTemplateClean = Handlebars.compile(panelTemplateSource);


      // get data for each question set...

      // depression questions
      depressionQuestions = data.surveys.depression.questions;
      // belief questions
      beliefQuestions = data.surveys.beliefs.questions;
      // anxiety questions
      anxietyQuestions = data.surveys.anxiety.questions;
      // insomnia questions
      insomniaQuestions = data.surveys.insomnia.questions;



      // load the first set of questions
      changeSection('insomnia');



      /////////////////////////////////
      ////// event handlers  //////////
      /////////////////////////////////

      $('#Card-Wrapper').on('input', '#myRange', function(){
        // we made a selection so enable the next button
        enableNext();
        var value = this.value;
        updateSliderValue(value);
      });


      // handler for tapping on an answer
      $('#Card-Wrapper').on('click', 'ul.question-list li', function(){
        // we made a selection so enable the next button
        enableNext();
      });


      $('.overlayPanel').on('click', '#Btn_Start', function(){
        // close the overlay and remove its contents
        closeOverlay();
      });


      $('#Btn_Continue').click(function(){
        $('.finishedOverlay').fadeOut();
      })



      // next button /////////////////////
      ////////////////////////////////////

      $('#Btn_Next').click(function(){
        var goToNum;
        // enable or disable previous button
        if(numCurrentQ == 0){
            numCurrentQ++;
            goToNum = numCurrentQ;
            updateScreen(goToNum);
            enablePrevious();
        }else if(numCurrentQ == numTotalQ - 1){
          // WE HAVE REACHED THE LAST QUESTION
            showFinishedOverlay();
          // go to the next section.
          switch(currentSection){
            case 'beliefs':
              changeSection('depression');
              break;
            case 'depression':
              changeSection('anxiety');
              break;
            case 'anxiety':
              changeSection('insomnia');
              break;
            case 'insomnia':
              changeSection('beliefs');
              // instead of looping back to beliefs we should show a finished screen here
              break;
            default:
              console.log('theres a problem with this statement');
          }
        }else{
          numCurrentQ++;
          goToNum = numCurrentQ;
          updateScreen(goToNum);
        }
      });

      // previous button /////////////////////
      ////////////////////////////////////////

      $('#Btn_Previous').click(function(){

        // show or hide previous button
        if(numCurrentQ > 0){
          numCurrentQ--;
        }

        var goToNum = numCurrentQ;
        updateScreen(goToNum);
      });


    }); ////////////////////////// dom ready ////////////////////////////////


    /////////////////////////////////
    ////// methods //////////////////
    /////////////////////////////////

    function updateSliderValue(val){
      $('#rangeOutput').html(val);
    }

    function closeOverlay(){
      // hide the overlay panel and remove its contents
      $('.overlayPanel').fadeOut('fast');
      $('.overlayPanel').empty();
    }

    function changeSection(newSection){

      // set the name of the new current section
      currentSection = newSection;

      switch(newSection){
        case 'beliefs':
          questionSet = beliefQuestions;
          break;
        case 'depression':
          questionSet = depressionQuestions;
          break;
        case 'anxiety':
          questionSet = anxietyQuestions;
          break;
        case 'insomnia':
          questionSet = insomniaQuestions;
          break;
        default:
          console.log('im not sure where to go, check change section');
      }

      // get questions length
      numTotalQ = questionSet.length;

      showOverlay(newSection);
      updateScreen(0);

    }


    function updateScreen(goToNum){

      var newScreenNum = goToNum;

      // if this is the first question in the set then disable the previous button
      if(newScreenNum == 0){
        disablePrevious();
      }else{
        enablePrevious();
      }

      // update current question variable
      numCurrentQ = newScreenNum;

      // disable next button
      // next gets enabled when a selection is made

      disableNext();

      // get current question text
      questionText = questionSet[numCurrentQ].question;
      // get answers for current question
      answers = questionSet[numCurrentQ].answers;
      // update current question number for display
      currentQuestionNum = newScreenNum + 1; // normalize

      // add data to the template
      var cardTemplateDirty = cardTemplateClean(questionSet[newScreenNum]);

      // show the people
      $('#Wrapper').fadeOut('fast',function(){
        $('#Card-Wrapper').html(cardTemplateDirty);
        updateHeader();
        updateProgressBar();
        if(currentSection == 'beliefs'){
          $('.slideWrapper').show();
        }
        $(this).fadeIn();
      });

    }

    function showOverlay(section){

      var panelContent;
      var data;

      switch(section){
        case 'beliefs':
          data = {
            panelHeading: "Beliefs about sleep",
            panelBody: "Several statements reflecting people’s beliefs and attitudes about sleep are in the following screens. Please indicate to what extent you personally agree or disagree with each statement. There is no right or wrong answer. For each statement, choose a number that best reflects your personal experience. Consider the whole scale, rather than only the extremes of the continuum.",
            btnLabel: "Start Quiz"
          };
          break;
        case 'anxiety':
          data = {
            panelHeading: "Anxiety Questionnaire",
            panelBody: "This set of questions asks about current anxiety levels. For each question, please select a response that best describes your answer. This question set takes about <x> time.",
            btnLabel: "Start Quiz"
          };
          break;
        case 'depression':
          data = {
            panelHeading: "Patient Health Questionnaire",
            panelBody: "This set of questions asks about mental health. (are we allowed to say depression or mental health here?). For each question, please select a response that best describes your answer. This question set takes about <x> time.",
            btnLabel: "Start Quiz"
          };
          break;
        case 'insomnia':
          data = {
            panelHeading: "Current Insomnia",
            panelBody: "This set of questions asks about your current symptoms of insomnia. For each question, please select a response that best describes your answer. This question set takes about <x> time.",
            btnLabel: "Start Quiz"
          };
          break;
        default:
          console.log('problem loading overlay panel');
      }

      panelTemplateDirty = panelTemplateClean(data);
      $('.overlayPanel').html(panelTemplateDirty);
      $('.overlayPanel').show();
    }

    function showFinishedOverlay(){
      $('.finishedOverlay').show();
    }

    function updateHeader(){
      $('#HeaderText').html("Question "+currentQuestionNum+" of "+ numTotalQ);
    }

    function updateProgressBar(){

      var progressBarIncrement = Math.round(100 / numTotalQ);
      var progressBarPosition = progressBarIncrement * currentQuestionNum;
      var progressBarWidth = progressBarPosition+'%';

      $('.progressBar-bar').css("width",progressBarWidth);
    }

    // check if there is a radio button selected
    function atLeastOneRadio() {
      return ($('input[type=radio]:checked').size() > 0);
    }

    function disableNext(){
      // disable the next button
      $("#Btn_Next").attr("disabled", true);
      $('#Btn_Next').addClass('disabled');
    }

    function disablePrevious(){
      // disable the previous button
      $("#Btn_Previous").attr("disabled", true);
      $('#Btn_Previous').addClass('disabled');
    }

    function enableNext(){
      // enable the next button
      $('#Btn_Next').removeAttr("disabled");
      $('#Btn_Next').removeClass('disabled');
    }

    function enablePrevious(){
      // disable the previous button
      $("#Btn_Previous").removeAttr("disabled");
      $('#Btn_Previous').removeClass('disabled');
    }



  </script>
