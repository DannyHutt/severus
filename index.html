<!DOCTYPE html>
<html>
  <head>
    <title>Severus Prototype</title>Â 
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="viewport" content= "width=device-width, user-scalable=no">

    <link rel="stylesheet" href="css/master.css">
    <link rel="manifest" href="json/manifest.json">
  </head>
  <body>
    <div id='Wrapper' class='wrapper'>
      <header>
        <h1 id="HeaderText">
          <!-- //////////////////////////////////// -->
          <!-- //////// headline goes here //////// -->
          <!-- //////////////////////////////////// -->
        </h1>
        <div class='progressBar-wrapper'>
          <div class='progressBar-bg'>
            <div class='progressBar-bar'></div>
          </div>
        </div> <!--  / .progressBar_wrapper -->
      </header>

      <div id="Card-Wrapper" class='card-wrapper'>
      <!-- //////////////////////////////////// -->
      <!-- //////// content goes here ///////// -->
      <!-- //////////////////////////////////// -->
      </div> <!--  / .content_wrapper -->

      <div class='btn-wrapper'>
        <button id="Btn_Next" class='btn btn-primary'>Next</button>
        <button id="Btn_Previous" class='btn btn-secondary'>Previous</button>
      </div>

    </div> <!--  / #Wrapper -->





    <div class="overlayPanel wrapper">

    </div> <!--  / .overlayPanel -->





  </body>

</html>


  <script src="js/scripts.js"></script>
  <script src="js/jquery-3.2.1.min.js"></script>
  <script src="js/handlebars-v4.2.0.js"></script>


  <!-- //////////////////////////////// -->
  <!-- //////// templates ///////////// -->
  <!-- //////////////////////////////// -->

  <script id="Card-Template" type="text/x-handlebars-template">
    <div class='content-card'>

      <p>{{headline}}</p>
      <h2>{{question}}</h2>

      <ul class="question-list">

        {{#each answers}}
          <li>
            <input type="radio" id="radio_{{answer}}" name="radio" />
            <label for="radio_{{answer}}"><span class="wrap"><span class="bullet"></span></span>{{answer}}</label>
          </li>
        {{/each}}

      </ul>
    </div>
  </script>

  <script id="Panel-Template" type="text/x-handlebars-template">
    <div class="panelContent">

      <h2>{{panelHeading}}</h2>
      <p>{{panelBody}}</p>

      <div class='btn-wrapper'>
        <!-- <button id="Btn_Continue" class='btn btn-primary'>Continue</button> -->
        <button id="Btn_Start" class='btn btn-primary'>{{btnLabel}}</button>
        <!-- <button id="Btn_Close" class='btn btn-primary'>Close</button> -->
      </div>

    </div>
  </script>


  <script type="text/javascript">

    var numCurrentQ;
    var depressionQuestions;
    var insomniaQuestions;
    var anxietyQuestions;
    var beliefQuestions;
    var questionSet;
    var questionText;
    var answers;
    var numTotalQ;
    var cardTemplateSource;
    var cardTemplateClean;
    var panelTemplateSource;
    var panelTemplateClean;
    var currentQuestionNum;
    var currentSection;



    $(function(){


      ////////////////////////////////
      ////// page load  //////////////
      ////////////////////////////////

      // get the handlebars tempalate structure
      cardTemplateSource = document.getElementById("Card-Template").innerHTML;
      panelTemplateSource = document.getElementById("Panel-Template").innerHTML;

      // sprinkle some magic dust
      cardTemplateClean = Handlebars.compile(cardTemplateSource);
      panelTemplateClean = Handlebars.compile(panelTemplateSource);





      // get data for each question set...

      // depression questions
      depressionQuestions = data.surveys.depression.questions;
      // belief questions
      beliefQuestions = data.surveys.beliefs.questions;
      // anxiety questions
      anxietyQuestions = data.surveys.anxiety.questions;
      // insomnia questions
      insomniaQuestions = data.surveys.insomnia.questions;



      // load the first set of questions
      changeSection('depression'); // this should be beliefs



      /////////////////////////////////
      ////// click handlers  //////////
      /////////////////////////////////


      // handler for tapping on an answer
      $('#Card-Wrapper').on('click', 'ul.question-list li', function(){
        // we made a selection so enable the next button
        enableNext();
      });


      $('.overlayPanel').on('click', '#Btn_Start', function(){
        // close the overlay and remove its contents
        closeOverlay();
      });



      // next button /////////////////////
      ////////////////////////////////////

      $('#Btn_Next').click(function(){
        var goToNum;
        // enable or disable previous button
        if(numCurrentQ == 0){
            numCurrentQ++;
            goToNum = numCurrentQ;
            updateScreen(goToNum);
            enablePrevious();
        }else if(numCurrentQ == numTotalQ - 1){
          // WE HAVE REACHED THE LAST QUESTION
          // go to the next section.
          switch(currentSection){
            case 'beliefs':
              changeSection('depression');
              break;
            case 'depression':
              changeSection('anxiety');
              break;
            case 'anxiety':
              changeSection('insomnia');
              break;
            case 'insomnia':
              changeSection('beliefs');
              break;
            default:
              console.log('theres a problem with this statement');
          }
        }else{
          numCurrentQ++;
          goToNum = numCurrentQ;
          updateScreen(goToNum);
        }
      });

      // previous button /////////////////////
      ////////////////////////////////////////

      $('#Btn_Previous').click(function(){

        // show or hide previous button
        if(numCurrentQ > 0){
          numCurrentQ--;
        }

        var goToNum = numCurrentQ;
        updateScreen(goToNum);
      });


    }); ////////////////////////// dom ready ////////////////////////////////


    /////////////////////////////////
    ////// methods //////////////////
    /////////////////////////////////

    function closeOverlay(){
      // hide the overlay panel and remove its contents
      $('.overlayPanel').hide();
      $('.overlayPanel').empty();
    }

    function changeSection(newSection){

      // set the name of the new current section
      currentSection = newSection;

      switch(newSection){
        case 'beliefs':
          questionSet = beliefQuestions;
          break;
        case 'depression':
          questionSet = depressionQuestions;
          break;
        case 'anxiety':
          questionSet = anxietyQuestions;
          break;
        case 'insomnia':
          questionSet = insomniaQuestions;
          break;
        default:
          console.log('im not sure where to go check change section');
      }

      // get questions length
      numTotalQ = questionSet.length;

      showOverlay(newSection);
      updateScreen(0);

    }


    function updateScreen(goToNum){

      var newScreenNum = goToNum;

      // if this is the first question in the set then disable the previous button
      if(newScreenNum == 0){
        disablePrevious();
      }else{
        enablePrevious();
      }

      // update current question variable
      numCurrentQ = newScreenNum;

      // disable next button
      // next gets enabled when a selection is made
      disableNext();

      // get current question text
      questionText = questionSet[numCurrentQ].question;
      // get answers for current question
      answers = questionSet[numCurrentQ].answers;

      // update current question number for display
      currentQuestionNum = newScreenNum + 1; // normalize
      // update the header
      updateHeader();

      // add data to the template
      var cardTemplateDirty = cardTemplateClean(questionSet[newScreenNum]);

      // show the people
      $('#Wrapper').fadeOut('fast',function(){
        $('#Card-Wrapper').html(cardTemplateDirty);
        $(this).fadeIn();
      });


    }

    function showOverlay(section){

      var panelContent;
      var data;

      switch(section){
        case 'beliefs':
          data = {
            panelHeading: "Beliefs about insomnia",
            panelBody: "This is part 1 of a 4 part quiz",
            btnLabel: "Start Quiz"
          };
          break;
        case 'anxiety':
          data = {
            panelHeading: "Anxiety",
            panelBody: "This is part 2 of a 4 part quiz",
            btnLabel: "Start Quiz"
          };
          break;
        case 'depression':
          data = {
            panelHeading: "Depression",
            panelBody: "This is part 3 of a 4 part quiz",
            btnLabel: "Start Quiz"
          };
          break;
        case 'insomnia':
          data = {
            panelHeading: "Insomnia",
            panelBody: "This is part 4 of a 4 part quiz",
            btnLabel: "Start Quiz"
          };
          break;
        default:
          console.log('problem loading overlay panel');
      }

      panelTemplateDirty = panelTemplateClean(data);
      $('.overlayPanel').html(panelTemplateDirty);
      $('.overlayPanel').show();
    }

    function updateHeader(){
      // update the header
      $('#HeaderText').html("Question "+currentQuestionNum+" of "+ numTotalQ);
    }

    // check if there is a radio button selected
    function atLeastOneRadio() {
      return ($('input[type=radio]:checked').size() > 0);
    }

    function disableNext(){
      // disable the next button
      $("#Btn_Next").attr("disabled", true);
      $('#Btn_Next').addClass('disabled');
    }

    function disablePrevious(){
      // disable the previous button
      $("#Btn_Previous").attr("disabled", true);
      $('#Btn_Previous').addClass('disabled');
    }

    function enableNext(){
      // enable the next button
      $('#Btn_Next').removeAttr("disabled");
      $('#Btn_Next').removeClass('disabled');
    }

    function enablePrevious(){
      // disable the previous button
      $("#Btn_Previous").removeAttr("disabled");
      $('#Btn_Previous').removeClass('disabled');
    }



    /////////////// /////////////// /////////////// /////////////// /////////////// ///////////////

    // here we need to add some logic for what to do at the end of a section...
    // need a transition page, look at what flavia was talking about for text that goes before or inbetween sections.

    // just need to choose the next section, switch the new data set and print it to the screen...
    // also need to deal with the structure of beliefs being different.. need a scrubber for that one too.
    // ** i should put the scrubber on code pen for later.

    // once that is all working need to look at cleaning things up, the feeling of going through it etc,
    // disable the zoom on mobile devices, see about full screen hacks...

    // might want to allow saving in place after they finish each section.
    // might want to remember the choices.
    // might want to create a landing page that lets you start at different spots.
    // might want to think about what it means to change the layout a bit..
    // same questions, but maybe just different selection controls (one tap vs two) or even a bot...


    // make sure it works good on an ipad.
    // send it.


    // ********* THEN *********** //
    // do some design work in sketch while waiting for feedback and start making updates to the prototype.


    // ***** how are we going to manage versions of prototypes?
    // maybe index should be the dashboard/landing screen where you choose your adventure.
    // then from there you launch into any of the 4 sections...?

    /////////////// /////////////// /////////////// /////////////// /////////////// ///////////////



  </script>
